<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patient Dashboard ‚Äì AfterHeal</title>
    <meta name="description"
        content="Track medications, appointments, missed-dose alerts, and emergency notification system.">
    <link rel="stylesheet" href="styles/global.css">
    <link rel="stylesheet" href="styles/dashboard.css">
    <style>
        /* ‚îÄ‚îÄ Patient-specific extras ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ */
        .med-overdue {
            border-left: 3px solid var(--poor) !important;
        }

        .overview-alert-banner {
            display: none;
            align-items: center;
            gap: 14px;
            background: linear-gradient(135deg, #FFF3CD, #FFF9E6);
            border: 1.5px solid #F0A500;
            border-radius: var(--radius);
            padding: 16px 20px;
            margin-bottom: 20px;
            color: #7D5A00;
            font-size: 0.9rem;
            line-height: 1.45;
        }

        /* Filter bar */
        .filter-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 16px;
            padding: 12px 16px;
            background: var(--surface2);
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
        }

        .filter-bar label {
            font-size: 0.82rem;
            color: var(--text-muted);
            font-weight: 600;
            white-space: nowrap;
        }

        .filter-bar select {
            border-radius: var(--radius-sm);
            font-size: 0.85rem;
            padding: 6px 10px;
            border: 1px solid var(--border);
            background: var(--surface);
            color: var(--text-primary);
            min-width: 180px;
        }

        /* Notification bell */
        .notif-bell-wrap {
            position: relative;
            display: inline-flex;
        }

        .notif-bell-btn {
            background: none;
            border: none;
            cursor: pointer;
            font-size: 1.4rem;
            padding: 4px 6px;
            border-radius: var(--radius-sm);
            transition: background .15s;
        }

        .notif-bell-btn:hover {
            background: var(--surface2);
        }

        .notif-badge {
            position: absolute;
            top: -2px;
            right: -2px;
            background: var(--poor);
            color: #fff;
            font-size: 0.62rem;
            font-weight: 800;
            border-radius: 50%;
            width: 17px;
            height: 17px;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .nav-notif-badge {
            display: none;
            background: var(--poor);
            color: #fff;
            font-size: 0.62rem;
            font-weight: 800;
            border-radius: 10px;
            padding: 1px 5px;
            margin-left: 6px;
        }

        /* Notification items */
        .notif-item {
            display: flex;
            align-items: flex-start;
            gap: 12px;
            padding: 14px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            margin-bottom: 8px;
        }

        .notif-unread {
            background: linear-gradient(135deg, #EBF5FF, #F8FBFF);
        }

        .notif-read {
            background: var(--surface2);
            opacity: .75;
        }

        .notif-icon {
            font-size: 1.4rem;
            flex-shrink: 0;
            margin-top: 2px;
        }

        .notif-body {
            flex: 1;
            min-width: 0;
        }

        .notif-msg {
            font-size: 0.88rem;
            line-height: 1.45;
            margin-bottom: 6px;
        }

        .notif-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Alert tab bar */
        .alert-tab-bar {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }

        .alert-tab-btn {
            padding: 7px 18px;
            border: 1.5px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            cursor: pointer;
            font-size: 0.85rem;
            font-weight: 600;
            transition: .15s;
        }

        .alert-tab-btn.active {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary);
        }

        /* Alert log entries */
        .alert-log-entry {
            display: flex;
            gap: 14px;
            padding: 14px 16px;
            border-radius: var(--radius-sm);
            border: 1px solid var(--border);
            margin-bottom: 8px;
            background: var(--surface);
        }

        .log-unack {
            border-left: 3px solid var(--poor);
        }

        .log-ack {
            opacity: .75;
        }

        .log-left {
            font-size: 1.4rem;
            flex-shrink: 0;
        }

        .log-body {
            flex: 1;
            min-width: 0;
        }

        .log-title {
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .log-detail {
            font-size: 0.77rem;
            color: var(--text-muted);
            margin-bottom: 6px;
        }

        .log-status-row {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Emergency contact cards */
        .ec-card {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 16px;
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            background: var(--surface);
            margin-bottom: 10px;
            transition: box-shadow .15s;
        }

        .ec-card:hover {
            box-shadow: var(--shadow-sm);
        }

        .ec-primary {
            border-left: 3px solid var(--good);
            background: linear-gradient(135deg, #F0FFF8, var(--surface));
        }

        .ec-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #fff;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .ec-info {
            flex: 1;
        }

        .ec-name {
            font-weight: 700;
            font-size: 0.95rem;
            margin-bottom: 4px;
            display: flex;
            align-items: center;
        }

        .ec-meta {
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
        }

        /* Phone error */
        .phone-error {
            font-size: 0.75rem;
            margin-top: 3px;
            min-height: 1.1em;
        }

        /* Caregiver assignment box */
        .caregiver-assign-box {
            background: var(--surface2);
            border: 1px solid var(--border);
            border-radius: var(--radius-sm);
            padding: 16px;
            margin-bottom: 16px;
        }

        /* SMS mode indicator */
        .sms-mode-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 0.78rem;
            padding: 4px 12px;
            border-radius: 99px;
            background: #E3F0FF;
            color: #1A6FC4;
            font-weight: 600;
        }
    </style>
</head>

<body class="theme-patient">
    <div class="sidebar-overlay" id="sidebar-overlay"></div>

    <div class="dashboard-shell">
        <!-- ‚ïê‚ïê SIDEBAR ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <aside class="sidebar" id="sidebar">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon theme-patient">üè•</div>
                <div>
                    <div class="sidebar-logo-text">AfterHeal</div>
                    <div class="sidebar-logo-sub">Patient Portal</div>
                </div>
            </div>
            <div class="sidebar-user">
                <div class="sidebar-avatar" id="sidebar-avatar" style="background:var(--patient-color)">A</div>
                <div>
                    <div class="sidebar-user-name" id="sidebar-user-name">Patient</div>
                    <div class="sidebar-user-role" id="sidebar-user-role">patient</div>
                </div>
            </div>
            <nav class="sidebar-nav">
                <div class="nav-group-label">My Health</div>
                <button class="nav-link active" data-section="section-overview">
                    <span class="nav-icon">üè†</span> Overview
                </button>
                <button class="nav-link" data-section="section-medications">
                    <span class="nav-icon">üíä</span> Medications
                </button>
                <button class="nav-link" data-section="section-appointments">
                    <span class="nav-icon">üìÖ</span> Appointments
                </button>
                <button class="nav-link" data-section="section-alerts">
                    <span class="nav-icon">üîî</span> Alerts &amp; Emergency
                    <span class="nav-notif-badge" id="nav-notif-badge"></span>
                </button>
                <button class="nav-link" data-section="section-summary">
                    <span class="nav-icon">üìä</span> Daily Summary
                </button>
            </nav>
            <div class="sidebar-footer">
                <button class="logout-btn"><span>üö™</span> Logout</button>
            </div>
        </aside>

        <!-- ‚ïê‚ïê MAIN CONTENT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
        <div class="main-content">
            <header class="topbar">
                <div class="topbar-left">
                    <button class="hamburger-btn" id="hamburger-btn" aria-label="Toggle menu">‚ò∞</button>
                    <div>
                        <div class="topbar-title" id="topbar-greeting">Welcome üëã</div>
                        <div class="topbar-subtitle">Patient Dashboard</div>
                    </div>
                </div>
                <div class="topbar-right">
                    <div class="topbar-date" id="topbar-date"></div>
                    <div class="notif-bell-wrap">
                        <button class="notif-bell-btn" id="notif-bell-btn" aria-label="Notifications"
                            onclick="document.querySelector('[data-section=section-alerts]').click()"
                            title="View missed-dose alerts">
                            üîî<span class="notif-badge" id="notif-badge"></span>
                        </button>
                    </div>
                    <button class="btn btn-outline btn-sm logout-btn">Logout</button>
                </div>
            </header>

            <main class="page-content">

                <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ OVERVIEW ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <section class="dashboard-section" id="section-overview">
                    <div class="page-header">
                        <h2>My Health Overview</h2>
                        <p>Medication adherence, today's schedule, and appointment summary at a glance.</p>
                    </div>

                    <div class="overview-alert-banner" id="overview-alert-banner"></div>

                    <div class="adherence-summary">
                        <div class="pct-big" id="adherence-pct-big">--</div>
                        <div class="pct-label">Overall Adherence Rate</div>
                        <div class="status-pill">Calculating‚Ä¶</div>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon stat-icon-green">‚úÖ</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-today-taken">0</div>
                                <div class="stat-label">Doses Taken Today</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon stat-icon-orange">‚è∞</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-today-upcoming">0</div>
                                <div class="stat-label">Upcoming Today</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background:#FFE5E5">‚ùå</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-today-missed" style="color:var(--poor)">0</div>
                                <div class="stat-label">Missed Today</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon stat-icon-purple">üìÖ</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-upcoming">0</div>
                                <div class="stat-label">Upcoming Appointments</div>
                            </div>
                        </div>
                    </div>

                    <div class="card-flat mt-16">
                        <h4 class="mb-8">üí° Adherence Insight</h4>
                        <span id="adherence-insight" class="badge badge-primary">Calculating‚Ä¶</span>
                    </div>
                </section>

                <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ MEDICATIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <section class="dashboard-section" id="section-medications" style="display:none">
                    <div class="page-header">
                        <h2>My Medications</h2>
                        <p>All prescribed medications. Mark doses as taken. Filter by prescribing doctor.</p>
                    </div>
                    <div class="card-flat mb-16">
                        <div class="flex-between mb-8">
                            <h4>Overall Adherence</h4>
                            <span id="stat-adherence" class="fw-700 text-primary-c">--%</span>
                        </div>
                        <div class="progress-wrap">
                            <div class="progress-bar progress-good" id="adh-bar-main" style="width:0%"></div>
                        </div>
                    </div>
                    <div class="filter-bar">
                        <label for="med-doctor-filter">üè• Filter by Doctor:</label>
                        <select id="med-doctor-filter" onchange="onMedDoctorFilterChange(this.value)">
                            <option value="">All Doctors</option>
                        </select>
                        <button class="btn btn-ghost btn-sm"
                            onclick="document.getElementById('med-doctor-filter').value='';onMedDoctorFilterChange('')">Clear</button>
                    </div>
                    <div id="med-list">
                        <div class="empty-state">
                            <div class="empty-icon">üíä</div>
                            <p>Loading medications‚Ä¶</p>
                        </div>
                    </div>
                </section>

                <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ APPOINTMENTS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <section class="dashboard-section" id="section-appointments" style="display:none">
                    <div class="page-header">
                        <h2>My Appointments</h2>
                        <p>Upcoming, missed, and attended appointments. Filter by doctor.</p>
                    </div>
                    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:20px">
                        <div class="stat-card">
                            <div class="stat-icon stat-icon-blue">üìÖ</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-upcoming2">0</div>
                                <div class="stat-label">Upcoming</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon stat-icon-orange">‚ö†Ô∏è</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-missed">0</div>
                                <div class="stat-label">Missed</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon stat-icon-green">‚úÖ</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-attended">0</div>
                                <div class="stat-label">Attended</div>
                            </div>
                        </div>
                    </div>
                    <div class="filter-bar">
                        <label for="appt-doctor-filter">üë®‚Äç‚öïÔ∏è Filter by Doctor:</label>
                        <select id="appt-doctor-filter" onchange="onApptDoctorFilterChange(this.value)">
                            <option value="">All Doctors</option>
                        </select>
                        <button class="btn btn-ghost btn-sm"
                            onclick="document.getElementById('appt-doctor-filter').value='';onApptDoctorFilterChange('')">Clear</button>
                    </div>
                    <div class="tab-bar" data-tab-container>
                        <button class="tab-btn active" data-tab="tab-upcoming">üìÖ Upcoming</button>
                        <button class="tab-btn" data-tab="tab-missed">‚ö†Ô∏è Missed</button>
                        <button class="tab-btn" data-tab="tab-attended">‚úÖ Attended</button>
                    </div>
                    <div class="tab-panel active" id="tab-upcoming">
                        <div id="upcoming-appts"></div>
                    </div>
                    <div class="tab-panel" id="tab-missed">
                        <div id="missed-appts"></div>
                    </div>
                    <div class="tab-panel" id="tab-attended">
                        <div id="attended-appts"></div>
                    </div>
                </section>

                <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ ALERTS & EMERGENCY SYSTEM ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <section class="dashboard-section" id="section-alerts" style="display:none">
                    <div class="page-header">
                        <h2>üîî Alerts &amp; Emergency System</h2>
                        <p>Missed-dose detection, SMS alert logs, emergency contacts, and caregiver assignment.</p>
                    </div>

                    <!-- Stats row -->
                    <div class="stats-grid" style="margin-bottom:20px">
                        <div class="stat-card">
                            <div class="stat-icon stat-icon-orange">üîî</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-notif-count">0</div>
                                <div class="stat-label">Total Alerts</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background:#FFE5E5">üìû</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-ec-count">0</div>
                                <div class="stat-label">Emergency Contacts</div>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon" style="background:#E3F0FF">üìã</div>
                            <div class="stat-info">
                                <div class="stat-value" id="stat-unack-count" style="color:var(--poor)">0</div>
                                <div class="stat-label">Unacknowledged Logs</div>
                            </div>
                        </div>
                    </div>

                    <!-- SMS gateway mode indicator -->
                    <div style="margin-bottom:16px">
                        <span class="sms-mode-badge">üì° SMS Gateway: Simulation Mode (Twilio/Fast2SMS-ready)</span>
                        <span style="font-size:0.78rem;color:var(--text-muted);margin-left:10px">
                            Switch to real SMS by calling <code>AHSmsGateway.setMode('twilio', config)</code> in
                            console.
                        </span>
                    </div>

                    <!-- Alert sub-tabs: Notifications | Alert History | Emergency Contacts | Caregiver -->
                    <div class="alert-tab-bar">
                        <button class="alert-tab-btn active" data-alert-tab="alert-tab-notifs">üîî Notifications</button>
                        <button class="alert-tab-btn" data-alert-tab="alert-tab-history">üìã Alert History</button>
                        <button class="alert-tab-btn" data-alert-tab="alert-tab-contacts">üìû Emergency Contacts</button>
                        <button class="alert-tab-btn" data-alert-tab="alert-tab-caregiver">üè• Caregiver</button>
                    </div>

                    <!-- ‚îÄ‚îÄ Tab: Notifications ‚îÄ‚îÄ -->
                    <div class="alert-tab-panel" id="alert-tab-notifs">
                        <div class="card">
                            <div
                                style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px">
                                <h3>Notification Feed</h3>
                                <div style="display:flex;gap:8px">
                                    <button id="btn-mark-all-read" class="btn btn-ghost btn-sm">‚úì Mark All Read</button>
                                    <button id="btn-clear-notifs" class="btn btn-danger btn-sm">üóë Clear All</button>
                                </div>
                            </div>
                            <div id="notif-list">
                                <div class="empty-state">
                                    <div class="empty-icon">üîî</div>
                                    <p>No notifications yet. Missed doses trigger alerts automatically.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ‚îÄ‚îÄ Tab: Alert History (Audit Trail) ‚îÄ‚îÄ -->
                    <div class="alert-tab-panel" id="alert-tab-history" style="display:none">
                        <div class="card">
                            <div
                                style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;flex-wrap:wrap;gap:8px">
                                <div>
                                    <h3>Alert History &amp; Audit Trail</h3>
                                    <p style="font-size:0.83rem;color:var(--text-muted);margin-top:4px">
                                        Full log of every SMS alert sent. Required for medical accountability.
                                    </p>
                                </div>
                                <button id="btn-ack-all-logs" class="btn btn-ghost btn-sm">‚úì Acknowledge All</button>
                            </div>
                            <div id="alert-history-list">
                                <div class="empty-state">
                                    <div class="empty-icon">üìã</div>
                                    <p>No alert history yet.</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- ‚îÄ‚îÄ Tab: Emergency Contacts ‚îÄ‚îÄ -->
                    <div class="alert-tab-panel" id="alert-tab-contacts" style="display:none">
                        <div class="card" style="margin-bottom:20px">
                            <h3 style="margin-bottom:8px">üìû Emergency Contacts</h3>
                            <p style="font-size:0.83rem;color:var(--text-muted);margin-bottom:16px">
                                Contacts receive SMS alerts when you miss a dose. Mark one as <strong>Primary</strong>
                                for priority notification.
                            </p>
                            <div id="ec-list"></div>
                        </div>

                        <!-- Add contact form -->
                        <div class="card">
                            <h4 style="margin-bottom:14px">‚ûï Add New Emergency Contact</h4>
                            <form id="ec-add-form" novalidate>
                                <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
                                    <div class="form-group">
                                        <label class="form-label">Full Name <span class="text-poor">*</span></label>
                                        <input id="ec-name" type="text" class="form-control"
                                            placeholder="e.g. Mary Johnson" required>
                                    </div>
                                    <div class="form-group">
                                        <label class="form-label">Relationship</label>
                                        <input id="ec-relation" type="text" class="form-control"
                                            placeholder="e.g. Mother, Spouse, Sibling">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Phone Number <span class="text-poor">*</span>
                                        <span style="font-size:0.75rem;color:var(--text-muted);font-weight:400"> (E.g.
                                            +1-555-0101 or +919876543210)</span>
                                    </label>
                                    <input id="ec-phone" type="tel" class="form-control" placeholder="+1-555-0101"
                                        required autocomplete="tel">
                                    <div class="phone-error" id="ec-phone-error"></div>
                                </div>
                                <div class="form-group" style="display:flex;align-items:center;gap:10px">
                                    <input type="checkbox" id="ec-primary" style="width:16px;height:16px">
                                    <label for="ec-primary" style="font-size:0.88rem;cursor:pointer">
                                        Set as <strong>Primary Contact</strong> (notified first)
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-primary">üìû Add Emergency Contact</button>
                            </form>
                        </div>
                    </div>

                    <!-- ‚îÄ‚îÄ Tab: Caregiver Assignment ‚îÄ‚îÄ -->
                    <div class="alert-tab-panel" id="alert-tab-caregiver" style="display:none">
                        <div class="card">
                            <h3 style="margin-bottom:8px">üè• Assign Caregiver</h3>
                            <p style="font-size:0.83rem;color:var(--text-muted);margin-bottom:16px">
                                Your assigned caregiver receives automatic SMS alerts and in-app notifications when you
                                miss a dose.
                            </p>

                            <div class="caregiver-assign-box">
                                <div style="margin-bottom:12px;font-weight:600;font-size:0.88rem">Currently Assigned:
                                </div>
                                <div id="assigned-caregiver-display">
                                    <span style="color:var(--text-muted);font-size:0.85rem">No caregiver assigned
                                        yet.</span>
                                </div>
                            </div>

                            <div style="display:flex;gap:12px;align-items:flex-end;flex-wrap:wrap">
                                <div class="form-group" style="flex:1;min-width:200px;margin-bottom:0">
                                    <label class="form-label">Select Caregiver</label>
                                    <select id="caregiver-assign-select" class="form-control">
                                        <option value="">No Caregiver Assigned</option>
                                    </select>
                                </div>
                                <button id="btn-assign-caregiver" class="btn btn-primary">Assign Caregiver</button>
                            </div>

                            <div
                                style="margin-top:20px;padding:14px;background:var(--surface2);border-radius:var(--radius-sm);font-size:0.83rem;color:var(--text-muted)">
                                <strong>How it works:</strong><br>
                                When you miss a dose (>30 min past scheduled time), AfterHeal automatically:
                                <ol style="margin:8px 0 0 16px;line-height:1.7">
                                    <li>Records a missed-dose notification in your alerts feed</li>
                                    <li>Sends an SMS to all emergency contacts</li>
                                    <li>Sends an SMS and in-app alert to your assigned caregiver</li>
                                    <li>Logs all actions in Alert History for medical accountability</li>
                                </ol>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ DAILY SUMMARY ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
                <section class="dashboard-section" id="section-summary" style="display:none">
                    <div class="page-header">
                        <h2>Daily Summary</h2>
                        <p>Adherence breakdown and personalised health insights.</p>
                    </div>
                    <div class="adherence-summary">
                        <div class="pct-big" id="adh-pct-big2">--%</div>
                        <div class="pct-label">Overall Adherence</div>
                        <div class="status-pill" id="summary-status-pill">Calculating‚Ä¶</div>
                    </div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px;margin-bottom:20px">
                        <div class="card">
                            <h4 class="mb-12">Today's Progress</h4>
                            <div style="display:flex;justify-content:space-between;margin-bottom:8px"><span
                                    style="font-size:0.88rem;color:var(--text-secondary)">Doses Taken</span><span
                                    class="fw-700 text-good" id="sum-taken">-</span></div>
                            <div style="display:flex;justify-content:space-between;margin-bottom:8px"><span
                                    style="font-size:0.88rem;color:var(--text-secondary)">Doses Missed</span><span
                                    class="fw-700 text-poor" id="sum-missed">-</span></div>
                            <div style="display:flex;justify-content:space-between"><span
                                    style="font-size:0.88rem;color:var(--text-secondary)">Upcoming</span><span
                                    class="fw-700 text-moderate" id="sum-upcoming">-</span></div>
                        </div>
                        <div class="card">
                            <h4 class="mb-12">Status Indicator</h4>
                            <div style="font-size:3rem;text-align:center;margin-bottom:8px" id="sum-emoji">üìä</div>
                            <div style="text-align:center;font-weight:700;font-size:1.1rem" id="sum-label">-</div>
                            <div style="text-align:center;margin-top:8px"><span id="adherence-insight2"
                                    class="badge badge-primary">-</span></div>
                        </div>
                    </div>
                    <div class="card">
                        <h4 class="mb-16">Adherence Scale</h4>
                        <div style="display:flex;gap:12px;flex-wrap:wrap">
                            <div
                                style="flex:1;min-width:140px;background:var(--good-bg);border-radius:var(--radius-sm);padding:14px;border-left:3px solid var(--good)">
                                <div class="fw-700 text-good mb-4">üü¢ Good (‚â•80%)</div>
                                <div style="font-size:0.82rem;color:var(--text-secondary)">Excellent adherence ‚Äî keep it
                                    up!</div>
                            </div>
                            <div
                                style="flex:1;min-width:140px;background:var(--mod-bg);border-radius:var(--radius-sm);padding:14px;border-left:3px solid var(--moderate)">
                                <div class="fw-700 text-moderate mb-4">üü° Moderate (60‚Äì79%)</div>
                                <div style="font-size:0.82rem;color:var(--text-secondary)">Set reminders to improve!
                                </div>
                            </div>
                            <div
                                style="flex:1;min-width:140px;background:var(--poor-bg);border-radius:var(--radius-sm);padding:14px;border-left:3px solid var(--poor)">
                                <div class="fw-700 text-poor mb-4">üî¥ Poor (&lt;60%)</div>
                                <div style="font-size:0.82rem;color:var(--text-secondary)">Contact your doctor or
                                    caregiver.</div>
                            </div>
                        </div>
                    </div>
                </section>

            </main>
        </div>
    </div>

    <!-- ‚îÄ‚îÄ Edit Emergency Contact Modal ‚îÄ‚îÄ -->
    <div class="modal-overlay" id="ec-edit-modal">
        <div class="modal">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Emergency Contact</h3>
                <button class="modal-close" onclick="closeEditModal()">&#x2715;</button>
            </div>
            <form id="ec-edit-form" novalidate>
                <input type="hidden" id="ec-edit-id">
                <input type="hidden" id="ec-edit-pid">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:14px">
                    <div class="form-group">
                        <label class="form-label">Full Name <span class="text-poor">*</span></label>
                        <input id="ec-edit-name" type="text" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Relationship</label>
                        <input id="ec-edit-relation" type="text" class="form-control">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Phone Number <span class="text-poor">*</span></label>
                    <input id="ec-edit-phone" type="tel" class="form-control" autocomplete="tel">
                    <div class="phone-error" id="ec-edit-phone-error"></div>
                </div>
                <div class="form-group" style="display:flex;align-items:center;gap:10px">
                    <input type="checkbox" id="ec-edit-primary" style="width:16px;height:16px">
                    <label for="ec-edit-primary" style="font-size:0.88rem;cursor:pointer">Set as <strong>Primary
                            Contact</strong></label>
                </div>
                <div style="display:flex;gap:10px">
                    <button type="submit" class="btn btn-primary flex-1">üíæ Save Changes</button>
                    <button type="button" class="btn btn-ghost" onclick="closeEditModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script src="scripts/auth.js"></script>
    <script src="scripts/notifications.js"></script>
    <script src="scripts/patient.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            AH.initTabs();
            // Initialize alert history tab on first open
            document.querySelector('[data-section="section-alerts"]')?.addEventListener('click', () => {
                setTimeout(() => {
                    if (window.AHNotif && AH.getSession()) {
                        AHNotif.renderAlertHistory(AH.getSession().userId);
                    }
                }, 80);
            });
        });
    </script>
</body>

</html>